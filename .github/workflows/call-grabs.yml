name: call-epg-grabbers
run-name: ${{ github.workflow }} âœ… ${{ github.event_name}}
on:
  workflow_call:
  workflow_dispatch:
  pull_request_target:
    branches: 'main'
    types: [closed]
  schedule:
  - cron: '30 1 */5 * *'
jobs:
  grab1:
    uses: ./.github/workflows/epg-grabber-1.yml
    secrets: inherit
  grab2:
    uses: ./.github/workflows/epg-grabber-2.yml
    secrets: inherit
  grab3:
    uses: ./.github/workflows/epg-grabber-3.yml
    secrets: inherit


  push:
    runs-on: ubuntu-latest
    needs: [grab1,grab2,grab3]
    steps:

      - name: Checkout
        uses: actions/checkout@v3

      - name: timestamp
        id: timestamp
        run: |
          date >> ./timestamp
          stamp=$(date -r ./timestamp)
          echo $stamp
          cd ${{ github.workspace }}
          sed -i "12s/.*/$stamp | epg-grabber/" ./README.md
        shell: bash

      - name: Tree
        run: |
         echo ***./***
         tree -h -L 2 ./

      - name: outputs_grabers
        needs: [grab1,grab2,grab3]
        run: |
         echo ${{ needs.grab1.outputs.output_grab1 }}
         echo ${{ needs.grab2.outputs.output_grab2 }}
         echo ${{ needs.grab3.outputs.output_grab3 }}


      - name: Update
        id: update
        run: |
          git config --global user.email ${{ secrets.EMAIL }}
          git config --global user.name ${{ secrets.NAME }}
          git config pull.rebase false
          git add ./README.md
          git commit -m "epg-grabber"
          git pull
          git push